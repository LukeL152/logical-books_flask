{% extends 'base.html' %}
{% from '_macros.html' import render_account_options %}

{% block content %}
<h1 class="mb-4">Add Transaction Rule</h1>

<form action="{{ url_for('transactions.add_transaction_rule') }}" method="post" class="p-3 border rounded">
    <div class="row">
        <div class="col-md-6">
            <label for="source_account_id" class="form-label">Source Account</label>
            <select id="source_account_id" name="source_account_id" class="form-select">
                <option value="">All Accounts</option>
                {{ render_account_options(accounts) }}
            </select>
        </div>
        <div class="col-md-6">
            <label for="keyword" class="form-label">Keyword</label>
            <input type="text" id="keyword" name="keyword" class="form-control">
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <label for="category_condition" class="form-label">Category</label>
            <input type="text" id="category_condition" name="category_condition" class="form-control">
        </div>
        <div class="col-md-6">
            <label for="transaction_type" class="form-label">Transaction Type</label>
            <select id="transaction_type" name="transaction_type" class="form-select">
                <option value="">Any</option>
                <option value="debit">Debit</option>
                <option value="credit">Credit</option>
            </select>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <label for="min_amount" class="form-label">Minimum Amount</label>
            <input type="number" step="0.01" id="min_amount" name="min_amount" class="form-control">
        </div>
        <div class="col-md-6">
            <label for="max_amount" class="form-label">Maximum Amount</label>
            <input type="number" step="0.01" id="max_amount" name="max_amount" class="form-control">
        </div>
    </div>

    <hr class="my-4">

    <h4 class="mb-3">Actions</h4>

    <div class="row">
        <div class="col-md-6">
            <label for="new_category" class="form-label">Set New Category</label>
            <input type="text" id="new_category" name="new_category" class="form-control">
        </div>
        <div class="col-md-6">
            <label for="new_description" class="form-label">Set New Description</label>
            <input type="text" id="new_description" name="new_description" class="form-control">
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <label for="new_debit_account_id" class="form-label">Set Debit Account</label>
            <select id="new_debit_account_id" name="new_debit_account_id" class="form-select">
                <option value="">Do Not Change</option>
                {{ render_account_options(accounts) }}
            </select>
        </div>
        <div class="col-md-6">
            <label for="new_credit_account_id" class="form-label">Set Credit Account</label>
            <select id="new_credit_account_id" name="new_credit_account_id" class="form-select">
                <option value="">Do Not Change</option>
                {{ render_account_options(accounts) }}
            </select>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="is_automatic" name="is_automatic" value="1" checked>
                <label class="form-check-label" for="is_automatic">
                    Apply Automatically
                </label>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="delete_transaction" name="delete_transaction" value="1">
                <label class="form-check-label" for="delete_transaction">
                    Delete Transaction
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="checkbox" id="flag_for_manual_assignment" name="flag_for_manual_assignment" value="1">
                <label class="form-check-label" for="flag_for_manual_assignment">
                    Flag for Manual Assignment
                </label>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <button type="submit" class="btn btn-primary">Add Rule</button>
        <a href="{{ url_for('transactions.transaction_rules') }}" class="btn btn-secondary">Cancel</a>
    </div>
</form>
{% endblock %}

{% block scripts %}
<script>
$(document).ready(function() {
    $('#source_account_id').select2();
    $('#new_debit_account_id').select2();
    $('#new_credit_account_id').select2();
});
</script>
{% endblock %}
