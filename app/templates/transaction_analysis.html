{% extends 'base.html' %}

{% block title %}Transaction Analysis - Logical Books{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <h2>Transaction Analysis</h2>
    <hr>
    <div id="analysis-grid" class="ag-theme-quartz" style="height: 600px; width: 100%;"></div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const gridOptions = {
        columnDefs: [
            { field: "date", filter: 'agDateColumnFilter', sortable: true },
            { field: "description", filter: true, sortable: true },
            { field: "amount", filter: 'agNumberColumnFilter', sortable: true, aggFunc: 'sum' },
            { field: "category", filter: true, sortable: true, enableRowGroup: true, enablePivot: true },
            { field: "debit_account", filter: true, sortable: true, enableRowGroup: true, enablePivot: true },
            { field: "credit_account", filter: true, sortable: true, enableRowGroup: true, enablePivot: true },
        ],
        defaultColDef: {
            flex: 1,
            minWidth: 150,
            resizable: true,
            sortable: true,
        },
        rowGroupPanelShow: 'always',
        pivotPanelShow: 'always',
        sideBar: true,
    };

    document.addEventListener('DOMContentLoaded', () => {
        const gridDiv = document.querySelector('#analysis-grid');
        const gridApi = agGrid.createGrid(gridDiv, gridOptions);

        fetch('/api/transaction_analysis')
            .then(response => response.json())
            .then(data => {
                gridApi.setGridOption('rowData', data);
            });
    });
</script>
{% endblock %}